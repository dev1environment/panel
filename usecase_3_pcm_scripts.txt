												 USECASE-3
												------------

DDL SCRIPT FOR STAGE
------------------------


CREATE TABLE
  usecase3_stage.table1 ( SYS_DT STRING,
    SYS_TM STRING,
    CREDIT_CARD_NUM STRING,
    TRAN_LOCAL_DT STRING,
    TRAN_LOCAL_TM STRING,
    CREDIT_CARD_ORG_ID STRING,
    PROD_NAME STRING,
    TRAN_MRCH_TYPE STRING,
    TRAN_MRCH_ID STRING,
    TRAN_MRCH_NAME STRING,
    TRAN_TYPE STRING,
    CREDIT_BAL_VAL STRING,
    TRAN_SYSTM_ACT_VAL STRING,
    TRAN_FINAL_ACT_VAL STRING,
    TRAN_REQUST_TYP_ID STRING,
    TRAN_ACTION_DESC STRING,
    TRAN_AMT STRING,
    TRAN_DCML_NUM STRING,
    TRAN_BILL_AMT STRING,
    TRAN_BILL_CDE STRING,
    ORG_CURR_DCML_NUM STRING,
    TRAN_CRNCY_CDE STRING,
    TRAN_ACTN_LNG_DESC STRING,
    TRAN_ACTION_CDE STRING,
    TRAN_POS_DATA_VAL STRING,
    TRAN_POS_COND_CDE STRING,
    CREDIT_LIMIT_AMT STRING,
    ITRAN_CAT_CDE STRING,
    TRAN_POS_ENT_CDE STRING,
    ITRAN_TUN_REQ_ID STRING,
    TRAN_TKN_MSG STRING,
    TRAN_SUB_DATA STRING,
    CREDIT_ACC_NUM STRING,
    CREDIT_CRD_ID STRING,
    TRAN_PROC_CODE STRING);

-------------------------------------------

DDL SCRIPT FOR HISTORY
------------------------

CREATE TABLE
  stage_pcm_dev.PCM_CARDS ( SYS_DT DATE,
    SYS_TM TIME,
    CREDIT_CARD_NUM STRING,
    TRAN_LOCAL_DT DATE,
    TRAN_LOCAL_TM TIME,
    CREDIT_CARD_ORG_ID INT64,
    PROD_NAME STRING,
    TRAN_MRCH_TYPE INT64,
    TRAN_MRCH_ID STRING,
    TRAN_MRCH_NAME STRING,
    TRAN_TYPE INT64,
    CREDIT_BAL_VAL INT64,
    TRAN_SYSTM_ACT_VAL STRING,
    TRAN_FINAL_ACT_VAL STRING,
    TRAN_REQUST_TYP_ID STRING,
    TRAN_ACTION_DESC STRING,
    TRAN_AMT INT64,
    TRAN_DCML_NUM INT64,
    TRAN_BILL_AMT INT64,
    TRAN_BILL_CDE INT64,
    ORG_CURR_DCML_NUM INT64,
    TRAN_CRNCY_CDE INT64,
    TRAN_ACTN_LNG_DESC STRING,
    TRAN_ACTION_CDE INT64,
     TRAN_POS_DATA_VAL STRING,
    TRAN_POS_COND_CDE INT64,
    CREDIT_LIMIT_AMT INT64,
    ITRAN_CAT_CDE STRING,
    TRAN_POS_ENT_CDE INT64,
    ITRAN_TUN_REQ_ID STRING,
    TRAN_TKN_MSG STRING,
    TRAN_SUB_DATA STRING,
    CREDIT_ACC_NUM STRING,
    CREDIT_CRD_ID INT64,
    TRAN_PROC_CODE STRING,
	SYS_DTTM DATETIME,
	LAST_UPDATED TIMESTAMP,
	COUNTRY_CODE STRING
	)
PARTITION BY SYS_DT;


DML SCRIPT FOR HISTORY
------------------------

INSERT INTO
  stage_pcm_dev.PCM_CARDS
SELECT
  PARSE_DATE('%d-%m-%Y',SYS_DT) AS SYS_DT,
  PARSE_TIME('%H:%M:%S',SYS_TM) AS SYS_TM,
  CREDIT_CARD_NUM STRING,
  PARSE_DATE('%d-%m-%Y',TRAN_LOCAL_DT) AS TRAN_LOCAL_DT,
  PARSE_TIME('%H:%M:%S',TRAN_LOCAL_TM) AS TRAN_LOCAL_TM,
  CAST (CREDIT_CARD_ORG_ID AS int64),
  PROD_NAME STRING,
  CAST (TRAN_MRCH_TYPE AS int64),
  TRAN_MRCH_ID STRING,
  TRAN_MRCH_NAME STRING,
  CAST (TRAN_TYPE AS int64),
  CAST (CREDIT_BAL_VAL AS int64),
  TRAN_SYSTM_ACT_VAL STRING,
  TRAN_FINAL_ACT_VAL STRING,
  TRAN_REQUST_TYP_ID STRING,
  TRAN_ACTION_DESC STRING,
  CAST (TRAN_AMT AS int64),
  CAST (TRAN_DCML_NUM AS int64),
  CAST (TRAN_BILL_AMT AS int64),
  CAST (TRAN_BILL_CDE AS int64),
  CAST (ORG_CURR_DCML_NUM AS int64),
  CAST (TRAN_CRNCY_CDE AS int64),
  TRAN_ACTN_LNG_DESC STRING,
  CAST (TRAN_ACTION_CDE AS int64),
  CASE
    WHEN TRAN_POS_DATA_VAL IS NULL THEN '0'
END
  AS TRAN_POS_DATA_VAL,
  CAST (TRAN_POS_COND_CDE AS int64),
  CAST (CREDIT_LIMIT_AMT AS int64),
  ITRAN_CAT_CDE STRING,
  CAST (TRAN_POS_ENT_CDE AS int64),
  ITRAN_TUN_REQ_ID STRING,
  TRAN_TKN_MSG STRING,
  TRAN_SUB_DATA STRING,
  CREDIT_ACC_NUM STRING,
  CAST (CREDIT_CRD_ID AS int64),
  TRAN_PROC_CODE STRING,
  PARSE_DATETIME('%d-%m-%Y %H:%M:%S',CONCAT(SYS_DT,' ',SYS_TM)) AS sys_dttm,
  current_timestamp AS LAST_UPDATED,
  CASE
    WHEN CREDIT_CARD_ORG_ID = '0' THEN 'IND'
    WHEN CREDIT_CARD_ORG_ID = '100' THEN 'USA'
    WHEN CREDIT_CARD_ORG_ID = '400' THEN 'UK'
    WHEN CREDIT_CARD_ORG_ID = '900' THEN 'CHN'
    WHEN CREDIT_CARD_ORG_ID IS NULL THEN 'PAK'
END
  AS COUNTRY_CODE
FROM
  usecase3_stage.table1;



